<html>
  <head>
  <script type="text/javascript" src="./bower_components/webcomponentsjs/webcomponents.js"></script>
  <link rel="import" href="./bower_components/polymer/polymer.html" />
  <script type="text/javascript" src="../bower_components/requirejs/require.js"></script>
  <script type="text/javascript" src="../sim.js"></script>
  <link rel="stylesheet" href="examples.css" type="text/css" />
  <dom-module id="s-pick">
    <template>
      <div class="form">
      <table>
        <tr>
          <td>Pallet Tray Capacity: </td>
          <td><input type="text" value="{{capacity}}"/></td>
        </tr>
        <tr>
          <td>Receive/Induct interval (min):</td>
          <td><input type="text" value="{{receiveInterval}}"/></td>
        </tr>
        <tr>
          <td>Mean interval between pick list arrival (min):</td>
          <td><input type="text" value="{{meanInterval}}" /></td>
        </tr>
        <tr>
          <td>Mean single pick transaction time (min):</td>
          <td><input type="text" value="{{singlePickTime}}" /></td>
        </tr>
        <tr>
          <td>Random number generation seed:</td>
          <td><input type="text" value="{{randomSeed}}" /></td>
        </tr>
        <tr>
          <td>Simulation time (min):</td>
          <td><input type="text" value="{{simTime}}"/></td>
        </tr>
      </table>
      <button on-click="_runSimulation">Run Simulation</button>
      </div>
      <template is="dom-repeat" items="[[results]]">
        <p>
          Simulation Results for:
          Pick Capacity = [[item.capacity]],
          Preparation Time = [[item.preparationTime]]
          Mean Arrival = [[item.meanArrival]]
          Seed = [[item.randomSeed]]
          Sim time = [[item.simTime]]
          <br>
          Average time at pick (min) = [[item.results_0]]
          Average number of customers in restaurant = [[item.results_2]]
        </p>
      </template>
      <button on-click="_clearResults">Clear</button>
    </template>
    <script>
      var Sim;
      Polymer({
        is: 's-pick',
        properties: {
          capacity: {
            type: Number,
            notify: true,
            value: 5
          },
          preparationTime: {
            type: Number,
            notify: true,
            value: 5
          },
          meanInterval: {
            type: Number,
            notify: true,
            value: 1
          },
          transactionTime: {
            type: Number,
            notify: true,
            value: 1
          },
          randomSeed: {
            type: String,
            notify: true,
            value: '1234'
          },
          simTime: {
            type: Number,
            notify: true,
            value: 240
          },
          results: {
            type: Array,
            value: [],
            notify: true
          }
        },
        _runSimulation() {
          var results = pickSimulation(
              this.capacity,
              this.receiveInterval,
              this.meanArrival,
              this.transactionTime,
              this.randomSeed,
              this.simTime);

          var msg = {
            capacity: this.capacity,
            receiveInterval: this.receiveInterval,
            meanArrival: this.meanArrival,
            transactionTime: this.transactionTime,
            randomSeed: this.randomSeed,
            simTime: this.simTime,
            results_0: results[0].toFixed(4),
            results_2: results[2].toFixed(4)
          };
          this.push('results', msg);
        },
        _clearResults() {
          this.set('results', []);
        }
      });
      function pickSimulation(
              BuffetCapacity,
              ReceiveInterval,
              MeanArrival,
              CashierTime,
              Seed,
              Simtime)
      {
          var sim = new Sim.Sim();
          var  = new Sim.Event('Request');
          var stats = new Sim.Population();
          var palletJack = new Sim.Facility('Pallet Jack');
          var palletTray = new Sim.Buffer('Pallet Tray');
          var station = new Sim.Facility('Stations');
          var random = new Sim.Random(parseInt(Seed));


          class PickLists extends Sim.Entity {
              start() {
                this.
              }
          };

          class Receiver extends Sim.Entity {
              start: function () {
                  this.putBuffer(palletTray, BuffetCapacity - buffet.current());
                  this.setTimer(ReceiveInterval).done(this.start);
              }
          };

          sim.addEntity(Customer);
          sim.addEntity(Chef);

      //  Uncomment these line to display logging information
      //    sim.setLogger(function (msg) {
      //        document.write(msg);
      //    });

          sim.simulate(Simtime);

          return [stats.durationSeries.average(),
                  stats.durationSeries.deviation(),
                  stats.sizeSeries.average(),
                  stats.sizeSeries.deviation()];

      }
    </script>
  </dom-module>
  </head>
  <body>
    <s-pick></s-pick>
  </body>
</html>


